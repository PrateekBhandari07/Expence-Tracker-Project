<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #eef2ff, #d8e0fb);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header {
            text-align: center;
            padding: 2rem;
        }
        .card-purple {
            background: linear-gradient(to right, #7b2ff7, #f107a3);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
        }
        .btn-gradient {
            background: linear-gradient(to right, #7b2ff7, #f107a3);
            color: white;
        }
        .btn-gradient:hover {
            background: linear-gradient(to right, #5a1fb3, #b00575);
        }
        #form-section, #history-section, #chart-section {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="header">
            <h1><b>ðŸ’° Expense Tracker</b></h1>
            <p>Track your spending and visualize your financial habits</p>
        </div>

        <div class="card card-purple mb-4">
            <h4>TOTAL EXPENSES</h4>
            <h2>â‚¹<span id="total-expenses">0.00</span></h2>
        </div>

        <div class="d-flex justify-content-center gap-3 mb-4">
            <button class="btn btn-outline-dark" onclick="showSection('form-section')">+ Add Expense</button>
            <button class="btn btn-outline-dark" onclick="showHistory()">View History</button>
            <button class="btn btn-outline-dark" onclick="showSection('chart-section')">Expense Chart</button>
        </div>

        <!-- Add Expense Form -->
        <div id="form-section">
            <div class="card p-4 shadow-sm mb-4">
                <h4 class="text-center mb-3">â‚¹ Add New Expense</h4>
                <form id="expense-form">
                    <div class="mb-3">
                        <label>Amount *</label>
                        <input type="number" step="0.01" class="form-control" id="amount" required>
                    </div>
                    <div class="mb-3">
                        <label>Category *</label>
                        <select class="form-select" id="category" required>
                            <option value="">Select a category</option>
                            <option value="Food">Food</option>
                            <option value="Travel">Travel</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label>Date *</label>
                        <input type="date" class="form-control" id="date" required>
                    </div>
                    <div class="mb-3">
                        <label>Description (Optional)</label>
                        <textarea class="form-control" id="description"></textarea>
                    </div>
                    <button type="submit" class="btn btn-gradient w-100">Add Expense</button>
                </form>
            </div>
        </div>

        <!-- History Section -->
        <div id="history-section" class="card p-4 shadow-sm mb-4">
            <h4 class="mb-3">Expense History</h4>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Date</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="expense-history"></tbody>
                </table>
            </div>
        </div>

        <!-- Chart Section -->
        <div id="chart-section">
            <div class="card p-4 shadow-sm mb-4">
                <h4 class="text-center mb-3">Expense Summary Chart</h4>
                <canvas id="expenseChart" height="100"></canvas>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById("expense-form");
        const totalExpensesEl = document.getElementById("total-expenses");
        const chartCtx = document.getElementById('expenseChart').getContext('2d');
        const historyList = document.getElementById("expense-history");

        let total = 0;
        let chartData = {
            labels: [],
            datasets: [{
                label: 'Expenses by Category',
                data: [],
                backgroundColor: ['#7b2ff7', '#f107a3', '#fbbf24', '#10b981']
            }]
        };

        const expenseChart = new Chart(chartCtx, {
            type: 'bar',
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Expense Summary' }
                }
            }
        });

        form.addEventListener("submit", async function (e) {
            e.preventDefault();
            const amount = parseFloat(document.getElementById("amount").value);
            const category = document.getElementById("category").value;
            const date = document.getElementById("date").value;
            const desc = document.getElementById("description").value;

            const payload = {
                userId: "default_user",
                amount,
                category,
                date,
                description: desc
            };

            await fetch("https://lezsk6n0w9.execute-api.us-east-1.amazonaws.com/Production/expenses", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            form.reset();
            showHistory();
        });

        async function showHistory() {
            await fetchAndDisplayHistory();
            showSection('history-section');
        }

        async function fetchAndDisplayHistory() {
            const response = await fetch("https://lezsk6n0w9.execute-api.us-east-1.amazonaws.com/Production/expenses?userId=default_user");
            const data = await response.json();

            historyList.innerHTML = "";
            total = 0;
            chartData.labels = [];
            chartData.datasets[0].data = [];

            if (data.length === 0) {
                historyList.innerHTML = "<tr><td colspan='5' class='text-center'>No expenses recorded yet.</td></tr>";
            } else {
                data.forEach(item => {
                    total += parseFloat(item.amount);
                    const idx = chartData.labels.indexOf(item.category);
                    if (idx === -1) {
                        chartData.labels.push(item.category);
                        chartData.datasets[0].data.push(parseFloat(item.amount));
                    } else {
                        chartData.datasets[0].data[idx] += parseFloat(item.amount);
                    }

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${item.category}</td>
                        <td>${item.description || "No description"}</td>
                        <td>${item.date}</td>
                        <td>â‚¹${parseFloat(item.amount).toFixed(2)}</td>
                        `;
                    historyList.appendChild(row);
                });
            }

            totalExpensesEl.innerText = total.toFixed(2);
            expenseChart.update();
        }

        async function editExpense(id, item) {
            const newAmount = prompt("Enter new amount:", item.amount);
            if (!newAmount) return;

            const updatedPayload = {
                userId: "default_user",
                id: id,
                amount: parseFloat(newAmount),
                category: item.category,
                date: item.date,
                description: item.description
            };

            await fetch(`https://b6ah9gezd4.execute-api.us-east-1.amazonaws.com/prod/expenses/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedPayload)
            });

            showHistory();
        }

        async function deleteExpense(id) {
            await fetch(`https://b6ah9gezd4.execute-api.us-east-1.amazonaws.com/prod/expenses/${id}`, {
                method: 'DELETE'
            });
            showHistory();
        }

        function showSection(id) {
            document.getElementById("form-section").style.display = "none";
            document.getElementById("history-section").style.display = "none";
            document.getElementById("chart-section").style.display = "none";
            document.getElementById(id).style.display = "block";
        }

        showSection('form-section');
    </script>
</body>
</html>
